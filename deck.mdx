import { Split, FullScreenCode } from 'mdx-deck/layouts'
export { default as theme } from './theme'
import Box from 'superbox'

# GraphQL
#### Ben Iofel
#### flow.io

---

```notes
What is GraphQL?

query lang & implementation
language agnostic
ask for only what you need
cool dev tools
```

- A query language for your API
- Replaces REST

---

```js
fetch('https://swapi.co/api/films')
fetch('https://swapi.co/api/people/1')
fetch('https://swapi.co/api/people/3')
fetch('https://swapi.co/api/people/7')
fetch('https://swapi.co/api/people/8')
...
```

---

<Box fontSize={25}>

```graphql
{
  allFilms {
    films {
      title
      characterConnection {
        characters {
          name
        }
      }
    }
  }
}
```

</Box>

<a href="https://graphql.github.io/swapi-graphql/?query=%7B%0A%20%20allFilms%20%7B%0A%20%20%20%20films%20%7B%0A%20%20%20%20%20%20title%0A%20%20%20%20%20%20characterConnection%20%7B%0A%20%20%20%20%20%20%20%20characters%20%7B%0A%20%20%20%20%20%20%20%20%20%20name%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A" target="_blank">run</a>

---

# Type System

---

```notes
Everything has a type.
Everything is introspectable
```

```graphql
type Query {
  hero(episode: Episode): Character
  droid(id: ID!): Droid
}

type Starship {
  id: ID!
  name: String!
  length(unit: LengthUnit = METER): Float
}

...

union SearchResult = Human | Droid | Starship
```

---

```notes
hit ctrl+space
```

<a href="https://graphql.github.io/swapi-graphql/" target="_blank">dev tools</a>

---

```notes
some graphql servers report timing information
```

![](gqlpg.png)

---

# Implementation

---

```js
const express = require('express');
const graphqlHTTP = require('express-graphql');
const { buildSchema } = require('graphql');

// Construct a schema, using GraphQL schema language
const schema = buildSchema(`
  type Query {
    rollDice(numDice: Int!, numSides: Int): [Int]
  }
`);
```

---

```js
// The root provides a resolver function for each API endpoint
const root = {
  rollDice: function ({numDice, numSides}) {
    const output = [];
    for (let i = 0; i < numDice; i++) {
      output.push(1 + Math.floor(Math.random() * (numSides || 6)));
    }
    return output;
  }
};
```

---

```js
const app = express();
app.use('/graphql', graphqlHTTP({
  schema: schema,
  rootValue: root,
  graphiql: true,
}));
app.listen(4000);
console.log('Running a GraphQL API server at localhost:4000/graphql');
```

---

```notes
Incrementally add your own implementation.
Make one request over internet and many requests in the same data center
```

<h1><a href="https://github.com/apicollective/graphql-rest-proxy" target="_blank">graphql-rest-proxy</a></h1>

Easily wrap your REST API in GraphQL

---

```notes
you define your models, enums, unions
you define resources as shown
```

export default FullScreenCode

```json
"organization": {
  "many": {
    "path": "/organizations",
    "params": {
      "id": { "type": "[string]", "required": false, "maximum": 100 },
      "name": { "type": "string", "required": false },
      "environment": { "type": "environment", "required": false },
      "limit": { "type": "long", "default": 25, "minimum": 1, "maximum": 100 },
      "offset": { "type": "long", "default": 0, "minimum": 0 },
      "sort": { "type": "string", "default": "name" }
    }
  }
},
```